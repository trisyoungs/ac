# Set language for the project
language: cpp

# Package dependencies
addons:
  apt:
    packages:
      - bison
      - pkg-config
      - libtool
      - automake
  homebrew:
    packages:
      - bison

# Secrets
secure: "OUzuaQuGjCR+2ZL6vs4SDSfQr2klvTx81zAAbYncj0fpWTxwiaQ9HMq6Mv7cXsUDnpQuy2dk1c6QiithuCzZ5yios0pI17Dv9ERkntUZZ3Jmfvsr6yTkxKwXWLORuhfR5bimUby6arc1bSDmy9LWsvIDcELN312QSkcBOxV7WX+6xhzFxShtgiqlnAS4rrgLY10ENQD2oNohe0eJxSw1y9tByQZ64d5m3ntBM/NaBnZBl+1mKfsUMcaanZ/6/Id1TZX5CNUAmvlq5LAUI3fCxn4DgXO2K2KKOTV/NocmsWKLT4xnC/xepdhfY+X/bygVZXSXarnTG98atIQuULu3NRzpTQyw3kAGoCl6TJlzzb2oBAc0qzYJItzwJX4EOAuauY03m3QYM2Pxu79PuwJFfukiNQHnSlokNnu+PKMpQn2q+Pad4exuBy3NYEJh6/7AP0gGWfWh+2miTI2za1eOkdvX2Ad/Q+Tm7IThBI748aT+4E2mJvey7H0yaOxiAQCOiY1YVnGs4HGpfjZoZtxlmuFC4oQoYvxabzdI0tFe/0rZVdiTmGv1AVbtyhszHjlwRKCExGopLpjiCmoA+L7efbyiXIlQhpOHYihdI18tWLlFkR5HQkj82F/VsYVJtwYHGKYtCsqkGkfyuZzPQEKf+9/AysXWocWXov7zlWRIhRo="

# Build Stages
jobs:
  include:
    - stage: Build
      name: Linux
      os: linux
      script: ./ci/ubuntu.trusty/ubuntu.build
      cache:
        directories:
          - artifacts
      before_deploy: ./ci/prep_deploy
      deploy:
        provider: releases
        skip_cleanup: true
        name: 22
        body: "Continuous build ${TRAVIS_TAG} ${RELEASE_NAME}"
        api_key: "${GITHUB_TOKEN}"
        file_glob: true
        file: artifacts/*AppImage
    - stage: Build
      name: OSX
      os: osx
      cache:
        directories:
          - artifacts
      script: ./ci/osx.highsierra/osx.build
      before_deploy: ./ci/prep_deploy
      deploy:
        provider: releases
        skip_cleanup: true
        api_key: "${GITHUB_TOKEN}"
        file: artifacts/*dmg

# Branch Safelist (allow only master and version-tagged branches)
branches:
  only:
    - master
    - /^v\d+\.\d+(\.\d+)?(-\S*)?$/
